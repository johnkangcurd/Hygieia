<div id="product-dashboard">

    <div class="product-dash-header clearfix">
        <div class="product-dash-header-text">
            Averages and trends are calculated over a 90 Day period.
        </div>
        <div class="product-dash-header-legend clearfix">
            <span class="commit-blocks-legend town-city">
                <div class="commit-blocks-legend-block">
                    <div class="state"></div> 1000 commits
                </div>
                <div class="commit-blocks-legend-block">
                    <div class="city"></div> 100 commits
                </div>
                <div class="commit-blocks-legend-block">
                    <div class="town"></div> 10 commits
                </div>
                <div class="commit-blocks-legend-block">
                    <div class="village"></div> 1 commit
                </div>
            </span>
        </div>
    </div>

    <div class="product-table">
        <div class="product-table-tr">
            <div class="product-table-th"></div>
            <div class="product-table-th" ng-repeat="stage in ctrl.stages">{{stage}}</div>
        </div>
        <div class="product-table-tbody">
            <div class="product-table-tr team-row"
                ng-repeat="team in ctrl.configuredTeams">

                <div class="product-table-td team-name-cell">
                    <span class="fa fa-cog" ng-click="ctrl.editTeam(team.collectorItemId)"></span>

                    <a title="{{item.customName || item.name}}" class="team-name" ng-click="ctrl.openDashboard(team)">
                        {{team.customName || team.name}}
                    </a>

                    <div class="team-quality">
                        <div class="team-quality-desc">
                            90-day Quality Metrics
                        </div>
                        <div class="team-quality-trends">
                            <div class="trend-wrap-6">
		                            <div class="trend text-center">
		                                {{codeCoverage = ctrl.getSummaryMetric(team.collectorItemId, 'codeCoverage');""}}
		                                <product-team-summary-field
		                                    number="team.summary.codeCoverage.number"
		                                    percent="true"
		                                    trend-up="{{codeNumber.trendUp}}"
		                                    success-state="{{codeNumber.successState}}"
		                                    caption="Code coverage"></product-team-summary-field>
		                            </div>
		                            <div class="trend text-center">
		                                {{funcTests = ctrl.getSummaryMetric(team.collectorItemId, 'functionalTestsPassed');""}}
		                                <product-team-summary-field
		                                    number="team.summary.functionalTestsPassed.number"
		                                    percent="true"
		                                    trend-up="{{funcTests.trendUp}}"
		                                    success-state="{{funcTests.successState}}"
		                                    caption="Func tests passed"></product-team-summary-field>
		                            </div>
		                            <div class="trend text-center">
		                                {{codeIssues = ctrl.getSummaryMetric(team.collectorItemId, 'codeIssues');""}}
		                                <product-team-summary-field
		                                    number="team.summary.codeIssues.number"
		                                    percent="false"
		                                    trend-up="{{codeIssues.trendUp}}"
		                                    success-state="{{codeIssues.successState}}"
		                                    caption="# of code issues"></product-team-summary-field>
		                            </div>
                            </div>
                    </div>
                </div>

                <div class="product-table-td team-data-cell"
                    ng-repeat="stage in ctrl.stages | filter: '!PROD'">
                    {{teamStageData = team.stages[stage].summary;""}}
                    <div ng-class="{'clickable':ctrl.teamStageHasCommits(team, stage)}" ng-if="teamStageData" ng-click="ctrl.viewTeamStageDetails(team, stage)">
                        <div class="team-data-cell-header">
                            <div class="clearfix team-data-cell-average-days" ng-if-start="teamStageData.average">
                                <!-- only leading zeros get small size -->
                                <span class="team-time-average-lg" ng-if="teamStageData.average.days">{{teamStageData.average.days}}</span>
                                <span class="team-time-average-desc" ng-if="teamStageData.average.days > 0">D</span>
                                <span class="team-time-average-lg" ng-if="teamStageData.average.hours > 0 || teamStageData.average.days > 0">{{teamStageData.average.hours}}</span>
                                <span class="team-time-average-desc" ng-if="teamStageData.average.hours > 0 || teamStageData.average.days > 0">H</span>
                                <span class="team-time-average-lg">{{teamStageData.average.minutes}}</span>
                                <span class="team-time-average-desc">M</span>
                            </div>
                            <div class="clearfix team-time-average" ng-if-end>
                                <span class="pull-left">Average</span>
                                    <span class="pull-right">
                                        <span>+/-</span>
                                        <span class="team-time-stddev-num">{{teamStageData.deviation.number}}</span>
                                        <span class="team-time-stddev-desc">{{teamStageData.deviation.descriptor}}</span>
                                    </span>
                            </div>

                            <div class="clearfix" ng-if-start="teamStageData.average == false">
                                <span class="team-time-average-lg">--</span>
                            </div>
                            <div class="clearfix team-time-average" ng-if-end>
                                <span class="pull-left">Calculating</span>
                            </div>
                        </div>

                        <div class="team-data-cell-body">
                            <div class="team-data-cell-last-updated" title="{{teamStageData.lastUpdated.longDisplay}}" ng-if="teamStageData.lastUpdated">
                                Updated: <span class="team-last-updated-num">{{teamStageData.lastUpdated.shortDisplay}}</span>
                            </div>

                            <commit-blocks commit-fail="teamStageData.commitsOutsideTimeframe" commit-pass="teamStageData.commitsInsideTimeframe"></commit-blocks>

                            <div class="clearfix"></div>
                        </div>

                        <div class="team-data-cell-last-build" ng-if="stage === 'Build'">
                            {{build = team.latestBuild;""}}
                            Latest build #: <span class="fa" ng-class="{'text-success fa-thumbs-up': build.success, 'text-danger fa-thumbs-down': !build.success}"></span> <span class="team-data-cell-last-build-num">{{build.number}}</span>
                        </div>
                    </div>

                </div>

                <div class="product-table-td team-prod-cell">
                    <div class="clearfix team-prod-average-header">
                        <span class="pull-left team-prod-arrow fa" ng-class="{'fa-long-arrow-up text-danger':team.prod.trendUp == true, 'fa-long-arrow-down text-success': team.prod.trendUp == false}" ng-if="team.prod.trendUp != undefined"></span>
                        <span class="pull-left product-text-active">{{team.prod.averageDays}}</span>
                        <span class="pull-left team-prod-average-days">DAY</span>
                    </div>

                    <div class="team-prod-average-desc">
                        average from commit to production
                    </div>

                    <div class="team-prod-last-90">
                        <span class="team-prod-last-90-num">{{team.prod.totalCommits}}</span>
                        <ng-pluralize count="team.prod.totalCommits" when="{1:' commit ',other:' commits '}"></ng-pluralize> in the last <span class="widget-font-bold">90 days</span>
                    </div>
                </div>
            </div>
            <div
                class="product-table-tr new-team-row"
                ng-class="{'no-teams': !ctrl.configuredTeams.length}"
                ng-click="ctrl.addTeam()">
                <div class="product-table-td">
                    <span class="fa fa-plus fa-thin-border"></span>
                    <div>Add a team</div>
                </div>
                <div class="product-table-td" ng-repeat="stages in ctrl.stages"></div>
            </div>
        </div>
    </div>

</div>